<h2>Reactivos: <small> Din√°micos </small></h2>
<hr>
<!--
    Le pasamos el formulario que le corresponde y le pasamos la propertie que es para cada campo con "formControlName"
-->
<form autocomplete="off" [formGroup]="myForm" (ngSubmit)="onSubmit()">

    <!-- Nombre -->
    <div class="mb-3 row">
        <label class="col-sm-3 col-form-label">Nombre</label>
        <div class="col-sm-9">
            <input class="form-control"
                   placeholder="Nombre de la persona"
                   formControlName="name"
            >
            @if ( formUtils.isValidField(myForm, 'name') ) {
              <span class="form-text text-danger">
                {{ formUtils.getfieldError( myForm, 'name' ) }}
              </span>
            }
        </div>
    </div>

    <!-- Agregar Favorito
          Este no lo vamos a manejar con una referencia local porque queremos aplicar validaciones a un campo que no este asociado a un formulario
          Al analizar el boton de Agregar a Favoritos veremos que por defecto todo el posteo del formulario, luego nos falto que al hacer click en el boton
          se envie los datos
    -->
    <div class="mb-3 row">
        <label class="col-sm-3 col-form-label">Agregar</label>
        <div class="col-sm-9">

            <div class="input-group">
                <!--
                    Este input lo tenemos que agregar a una propiedad de la clase de angular y tiene que ser de manera dinamica
                    lo pasamos entre llaves [] y lo igualamos al nombre del campo

                    Cuando precionen el Enter vamos a llamar un metodo para agregar el elemento
                    no ocupamos mandarle ningun argumento porque el valor de la caja de texto ya lo tenemos validado en el "newFavorite"

                    Evitar la propagacion por defecto del formulario
                      para esto nos creamos otro evento pero ahora le pasamos $event
                -->
                <input class="form-control"
                       placeholder="Agregar favorito"
                       [formControl]="newFavorite"
                       (keydown.enter)="onAddToFavorites()"
                       (keydown.enter)="$event.preventDefault()"
                >


                <button class="btn btn-outline-primary"
                        type="button"
                        (click)="onAddToFavorites()"
                        >
                    Agregar favorito
                </button>
            </div>
        </div>
    </div>


    <!-- Lista de Juegos Favoritos -->
    <div class="mb-3 row">
        <label class="col-sm-3 col-form-label">Favoritos</label>
        <!--
            Tenemos que decirle a angular que este elemento es el que maneja el array
            para eso nos vamos al elemento HTML que contiene todo el arreglo
        -->
        <div class="col-sm-9" formArrayName="favoriteGames">
            <!--
                Esto es lo que ocupamos duplicar por la cantidad de elementos que tengamos en "FavoriteGames"
                para eso nos creamos el "get" en el componente e invocar facilmente esta propertie
            -->
            @for (favoriteGame of favoriteGames.controls; track $index; let i = $index) {
              <div class="mb-1">
                  <div class="input-group">
                      <!--
                          Esto es igual a "i" porque como tenemos un arreglo y la unica manera de identificar las posiciones es por el indice
                          por eso le pasamos el nombre del indice que tengamos en este momento en el bucle
                      -->
                      <input class="form-control"
                        [formControlName]="i"
                      />

                      <!--
                        Aqui vamos a hacer que el boton nos borre el elemento del arreglo mandandole la posicion del indice
                      -->
                      <button class="btn btn-outline-danger"
                              type="button"
                              (click)="onDeleteFavorite(i)"
                      >
                        Eliminar
                      </button>
                  </div>
                  @if ( formUtils.isValidFieldInArray(favoriteGames, i) ) {
                    <!-- Debemos de mostrar el error en el campo basado en la posicon indice -->
                    <span class="form-text text-danger">
                      {{ formUtils.getfieldErrorInArray( favoriteGames, i ) }}
                    </span>
                  }
              </div>
            }
            <!--
                Mostramos el error que le indique al usuario que le faltamos elementos a la lista de agregar
            -->
            @if ( formUtils.isValidField(myForm, 'favoriteGames') ) {
              <span class="form-text text-danger">
                Debe de tener al menos 2 juegos
              </span>
            }
        </div>
    </div>



    <div class="row">
        <div class="col-sm-12">
            <!-- Hacemos que si el formulario no sea valido, el boton de guardad este desactivado -->
            <button type="submit"
                    class="btn btn-primary float-end"
                    [disabled]="myForm.invalid"
                    >
                Guardar
            </button>
        </div>
    </div>


</form>



<span>Valid</span>
<pre>{{ myForm.valid | json }}</pre>
<br>

<span>Value</span>
<pre>{{ myForm.value | json }}</pre>
<br>

<span>Agregar Juego</span>
<pre>{{ myForm.controls['favoriteGames'].errors | json }}</pre>
<pre>{{ myForm.controls['favoriteGames'].value | json }}</pre>
